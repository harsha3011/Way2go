import React from 'react';
import axios from 'axios';
import * as ApiUrls from '../Constants/apiUrls';
import { BrowserRouter, Route, Switch, Redirect } from 'react-router-dom';
import { Storage, RedirectFunctions } from 'way2go-common';

class SessionValid extends React.Component {
  constructor(props) {
    super(props);

    this.state = {};
  }

  componentWillMount() {
    axios.post(ApiUrls.orgservice + "/userService/validSession", {
      key: Storage().getAuthToken()
    }).then((response) => {
      this.setState({sessionValid: response.data});
    });
  }

  render() {
    let loginUrl = '/authentication/login/' + Storage().getValue(Storage().options.ORG_ID)
    return (
      <div>
        {
          this.state.sessionValid == false &&
          <Redirect to={loginUrl} />
        }
        {
          this.props.location && this.props.location.pathname.indexOf('/authentication/login') == 0 &&
            this.state.sessionValid == true &&
            <Redirect to={RedirectFunctions.getAfterLoginUrl()} />
        }
      </div>
    )
  }
}

export default SessionValid;
