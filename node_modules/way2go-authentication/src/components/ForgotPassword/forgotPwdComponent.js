import React from 'react';
import ReactDOM from 'react-dom';

import TextField from 'material-ui/TextField';
import RaisedButton from 'material-ui/RaisedButton';
import Snackbar from 'material-ui/Snackbar';

import muiThemeable from 'material-ui/styles/muiThemeable';
import {AlertService} from 'way2go-common'; 
import { Storage } from 'way2go-common';
import ForgotPwdApi from './forgotPwdApi';

const snackBarHeight={
    height:"70%"
}
class ForgotPassword extends React.Component{
    constructor(props){
        super(props);
        this.state = { 
            statusMessage: "",
            userName:"",
            email:"",
            errorMsgUserName:"",
            errorMsgEmail:"",
            showAlert:false,
            open:true
         };
         this.handleuserName.bind(this)
    }
    //function to hit th api and get the response
    saveChanges=(user)=>{
        ForgotPwdApi.forgotPwd(user).then(response => {
             if(response.data.message === "success"){
                 this.setState({statusMessage:response.data.data,showAlert:true});
             }
             else{
                this.setState({statusMessage:response.data.message,showAlert:true});
             }

         })
	}

    handleSubmit=()=>{
        if(this.state.userName.length==0){
            this.setState({errorMsgUserName:"This field is required"});
        }
        if(this.state.email.length==0){
            this.setState({errorMsgEmail:"This field is required"});
        }
        if(this.state.userName.length!=0 && this.state.email.length!=0)
        {
            var atpos = this.state.email.indexOf("@");
            var dotpos = this.state.email.lastIndexOf(".");
            if (atpos<1 || dotpos<atpos+2 || dotpos+2>=this.state.email.length) {
                this.setState({errorMsgEmail:"Not a valid e-mail address"});
            }
            else{
                this.setState({errorMsgEmail:""});
                var user={};
                user.orgId=Storage().getValue(Storage().options.ORG_ID).toString();
                user.userName=this.state.userName;
                user.email=this.state.email;
                this.saveChanges(user);
            }
        }    
    }
    handleuserName=(e)=> {
        this.setState({userName: e.target.value});
        if(e.target.value.length == 0){
            console.log("length",e.target.value.length);
            this.setState({errorMsgUserName:"This field is required"});
        }
        else{
            this.setState({errorMsgUserName:""});
        }
    }
    handleemailId=(e)=>{
        this.setState({email: e.target.value});
        if(e.target.value.length == 0){
            this.setState({errorMsgEmail:"This field is required"});
        }
        else{
            this.setState({errorMsgEmail:""});
        }
    }
    render(){
        return(
            <div>
                    <TextField onChange={this.handleuserName} errorText={this.state.errorMsgUserName} name="userName" id="userName" floatingLabelText="User Name" autoFocus={true} fullWidth={true} />
                    <br />
                    <TextField onChange={this.handleemailId}  errorText={this.state.errorMsgEmail}name="email" id="email" floatingLabelText="Email Id" fullWidth={true} />
                    <br />
                    <br />
                    <div style={{padding: '8px 16px'}}>
                        <RaisedButton label="Submit" primary onClick={this.handleSubmit} fullWidth={true}/>
                    </div>
                    <br />
                    <div style={{cursor:'pointer'}}  onClick={function(){document.getElementById("loginComponent").style.display='block';document.getElementById("forgotPwdComponent").style.display='none';}}><u>Back to Login</u></div>
                    <br /> 
                  
                    <Snackbar
                        open={this.state.showAlert}
                        message={this.state.statusMessage}
                        autoHideDuration={4000}
                        bodyStyle={snackBarHeight}
                    />
            </div>    
        );
    }
}


export default  muiThemeable()(ForgotPassword);
