import React from 'react';
import muiThemeable from 'material-ui/styles/muiThemeable';

import Avatar from 'material-ui/Avatar';

class UserAvatar extends React.Component {

  constructor(props) {
    super(props);

    this.state = {
      showInitials: !this.props.url
    }
  }

  checkAbsoluteUrl = (str) => {
      let pat = /^https?:\/\//i;
      if (pat.test(str))
          return true;
      else
          return false;
  }

  getUrl = () => {
    let url = this.props.url;

    if(url && this.checkAbsoluteUrl(url) == false) {
      url = 'https://4cwebappdev.azurewebsites.net/app/public/core/assets/images/' + url;
    }

    return url;
  }

  render() {
    return (
      this.state.showInitials ?

      <Avatar size={this.props.size || 32} backgroundColor={this.props.muiTheme.palette.primary1Color}>
        {this.props.firstName.charAt(0).toUpperCase() + this.props.lastName.charAt(0).toUpperCase()}
      </Avatar>

      :

      <Avatar size={this.props.size || 32} src={this.getUrl()} onError={() => {this.setState({showInitials: true})}}/>
    );
  }
}

export default muiThemeable()(UserAvatar);
